# Upstash Vector Database Upload Script

This standalone Python script reads documents from the `documents/` directory and uploads them to an Upstash Vector Database using Upstash's built-in embedding models.

## Features

- **Multi-format support**: Handles JSON Lines (Slack messages), regular text files, and other formats
- **Intelligent chunking**: Splits large documents into manageable chunks with word boundary preservation
- **Batch processing**: Uploads vectors in batches to optimize performance and avoid rate limits
- **Rich metadata**: Preserves document metadata including source, timestamps, users, channels, etc.
- **Error handling**: Graceful error handling with detailed progress reporting
- **Deduplication**: Creates unique IDs to prevent duplicate uploads

## Requirements

1. **Python 3.7+**
2. **Dependencies** (install with `pip install -r upstash_requirements.txt`):
   - `requests>=2.31.0`

3. **API Credentials** (set as environment variables):
   - `UPSTASH_VECTOR_URL`: Your Upstash Vector database URL
   - `UPSTASH_VECTOR_TOKEN`: Your Upstash Vector database token

## Setup

1. **Install dependencies**:
   ```bash
   pip install -r upstash_requirements.txt
   ```

2. **Set environment variables**:
   ```bash
   export UPSTASH_VECTOR_URL="https://your-db-url.upstash.io"
   export UPSTASH_VECTOR_TOKEN="your-token-here"
   ```

   Or create a `.env` file and load it:
   ```bash
   # .env file
   UPSTASH_VECTOR_URL=https://your-db-url.upstash.io
   UPSTASH_VECTOR_TOKEN=your-token-here
   ```

## Usage

1. **Place documents** in the `documents/` directory
2. **Run the script**:
   ```bash
   python upstash_vector_upload.py
   ```

## Document Formats Supported

### Slack Messages (JSON Lines)
Files starting with `mock_slack` are treated as JSON Lines format:
```json
{"type": "message", "user": "U06MAX", "text": "The build is failing...", "ts": "1736795245.168068", "channel": "C01DEV"}
```

### Regular Text Files
Plain text files are uploaded as single documents or chunked if large.

### Other Files
Any other file format is treated as plain text.

## Configuration

You can modify these constants in the script:

- `CHUNK_SIZE = 500`: Characters per chunk
- `BATCH_SIZE = 50`: Data items to upload in one batch

## Output

The script provides detailed progress information:

```
ðŸš€ Starting document upload to Upstash Vector DB
Vector DB URL: https://your-db-url.upstash.io
Chunk size: 500 characters
Batch size: 50 data items
Embeddings: Generated by Upstash

âœ… Connected to Upstash Vector DB: 0 existing vectors
Reading mock_slack_messages_6mo.txt...
Read 10000 documents
Creating text chunks...
Created 10000 chunks from 10000 documents
Processing batch 1/200
  Uploading to Upstash...
  âœ… Uploaded 50 data items. Total: 50
...
ðŸŽ‰ Upload complete! Total data items uploaded: 10000
```

## Metadata Structure

Each vector includes rich metadata:

```json
{
  "source": "mock_slack_messages_6mo.txt",
  "line_number": 1,
  "user": "U06MAX",
  "channel": "C01DEV",
  "timestamp": "2025-01-13 15:20:45",
  "ts": "1736795245.168068",
  "type": "slack_message",
  "chunk_index": 0,
  "total_chunks": 1,
  "chunk_length": 45
}
```

## Error Handling

- **Connection errors**: Validates API credentials before processing
- **File errors**: Skips problematic files and continues processing
- **Batch errors**: Retries failed batches and reports errors
- **Rate limiting**: Includes delays between batches

## Notes

- The script creates unique IDs for vectors to prevent duplicates
- Large documents are automatically chunked with word boundary preservation
- Slack message timestamps are converted to human-readable format
- Progress is reported in real-time with detailed batch information
- Embeddings are automatically generated by Upstash (no external embedding service needed)